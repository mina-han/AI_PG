# ìˆ˜ì • ì‚¬í•­ - ì—ìŠ¤ì»¬ë ˆì´ì…˜ ê°œì„  (2025-01-17)

## ë¬¸ì œì  ë° í•´ê²° ë°©ì•ˆ

### 1. âœ… í•œ ëª…ì´ë¼ë„ ì „í™” ë°›ìœ¼ë©´ ì¦‰ì‹œ ì¢…ë£Œ

**ë¬¸ì œ**: ì´ë¯¸ êµ¬í˜„ë˜ì–´ ìˆì—ˆìœ¼ë‚˜ í™•ì¸ í•„ìš”í–ˆìŒ.

**í•´ê²°**: `escalate_with_status` í•¨ìˆ˜ì—ì„œ `return` ë¬¸ì´ ì •ìƒ ì‘ë™í•˜ë„ë¡ í™•ì¸ ì™„ë£Œ.

```python
# ê²°ê³¼ ì „ì†¡
if result['status'] == 'answered':
    yield f"data: {json.dumps({'type': 'call_answered', ...})}\n\n"
    yield f"data: {json.dumps({'type': 'escalation_complete', ...})}\n\n"
    return  # ì„±ê³µ ì‹œ ì¦‰ì‹œ ì¢…ë£Œ âœ…
```

---

### 2. âœ… ì´ ì²˜ë¦¬ ì‹œê°„ ì‹¤ì‹œê°„ ì¸¡ì •

**ë¬¸ì œ**: ì´ ì²˜ë¦¬ ì‹œê°„ì´ 4.9ì´ˆë¡œ í‘œì‹œë¨ (ì‹œë®¬ë ˆì´ì…˜ delay ì‹œê°„). ì‹¤ì œ ì „í™” ì‹œê°„ì´ 20ì´ˆ ì´ìƒì¸ë°ë„ ë¶ˆêµ¬í•˜ê³  ì •í™•í•˜ì§€ ì•ŠìŒ.

**í•´ê²°**:
- JavaScriptì—ì„œ `startTime` ë³€ìˆ˜ ì¶”ê°€
- ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘ ì‹œ `Date.now()` ê¸°ë¡
- ì¢…ë£Œ ì‹œ ì‹¤ì œ ê²½ê³¼ ì‹œê°„ ê³„ì‚°

**ë³€ê²½ ì „**:
```javascript
pushLog(`ì´ ì²˜ë¦¬ ì‹œê°„: ${((delay * 7) / 1000).toFixed(1)}ì´ˆ`);
```

**ë³€ê²½ í›„**:
```javascript
startTime = Date.now();  // ì‹œì‘ ì‹œ
// ...
const elapsedTime = ((Date.now() - startTime) / 1000).toFixed(1);
pushLog(`ì´ ì²˜ë¦¬ ì‹œê°„: ${elapsedTime}ì´ˆ`);  // ì‹¤ì œ ê²½ê³¼ ì‹œê°„
```

---

### 3. âœ… ì „í™” ìˆ˜ì‹  ì˜¤íƒ ë¬¸ì œ í•´ê²°

**ë¬¸ì œ**: ì •ë‹´ë‹¹ìê°€ 3ë²ˆì§¸ ì‹œë„ì—ì„œ ì „í™”ë¥¼ ë°›ì•˜ëŠ”ë°ë„ "ì‹¤íŒ¨"ë¡œ í‘œì‹œë¨.

**ì›ì¸ ë¶„ì„**:
- `check_call_status` í•¨ìˆ˜ì—ì„œ `answered_by` í•„ë“œ ì²´í¬
- Twilioì—ì„œ ì´ í•„ë“œëŠ” í•­ìƒ ì¡´ì¬í•˜ì§€ ì•ŠìŒ
- `duration` í•„ë“œë§Œìœ¼ë¡œ íŒì •í•˜ëŠ” ê²ƒì´ ë” ì •í™•

**í•´ê²°**:
- `duration >= 5ì´ˆ` ê¸°ì¤€ìœ¼ë¡œ ì „í™” ìˆ˜ì‹  íŒì •
- ë©”ì‹œì§€ë¥¼ 2ë²ˆ ë°˜ë³µí•˜ë¯€ë¡œ ìµœì†Œ 10ì´ˆ ì´ìƒ í†µí™” ì˜ˆìƒ
- 5ì´ˆ ì´ìƒì´ë©´ "answered"ë¡œ íŒì •

**ë³€ê²½ ì „**:
```python
if status == "completed":
    # answered_byê°€ ìˆìœ¼ë©´ ì‚¬ëŒì´ ë°›ìŒ âŒ (í•­ìƒ ìˆëŠ” ê²ƒì€ ì•„ë‹˜)
    if call.answered_by and call.answered_by != "machine_start":
        return {"status": "answered", ...}
    elif call.duration and int(call.duration) > 0:
        return {"status": "answered", ...}
```

**ë³€ê²½ í›„**:
```python
if status == "completed":
    # duration ì²´í¬ (ë¬¸ìì—´ì¼ ìˆ˜ë„ ìˆìŒ)
    duration = 0
    try:
        if call.duration:
            duration = int(call.duration)
    except (ValueError, TypeError):
        duration = 0
    
    # durationì´ 5ì´ˆ ì´ìƒì´ë©´ ë°›ì€ ê²ƒìœ¼ë¡œ ê°„ì£¼
    if duration >= 5:
        return {"status": "answered", "duration": duration}  âœ…
    else:
        return {"status": "no-answer", "duration": 0}
```

---

### 4. âœ… "API ì—°ê²° ì¤‘..." ë¡œê·¸ ì‚­ì œ

**ë¬¸ì œ**: ë¶ˆí•„ìš”í•œ ë¡œê·¸ ë©”ì‹œì§€ ì¶œë ¥.

**í•´ê²°**: HTMLì—ì„œ í•´ë‹¹ ë¡œê·¸ ë¼ì¸ ì œê±°.

**ë³€ê²½ ì „**:
```javascript
pushLog(`API ì—°ê²° ì¤‘... (${API_BASE_URL}/simulator/call)`);  âŒ
```

**ë³€ê²½ í›„**:
```javascript
// "API ì—°ê²° ì¤‘..." ë¡œê·¸ ì œê±° (ìš”ì²­ì‚¬í•­ 4ë²ˆ)  âœ…
```

---

## ì¶”ê°€ ê°œì„  ì‚¬í•­

### íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€ (í•œêµ­ ì‹œê°„)

ëª¨ë“  ì´ë²¤íŠ¸ì— í•œêµ­ ì‹œê°„ íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€:

**Backend** (`app/routers/simulator.py`):
```python
from datetime import datetime
from zoneinfo import ZoneInfo

def get_timestamp():
    """í•œêµ­ ì‹œê°„ íƒ€ì„ìŠ¤íƒ¬í”„ ìƒì„±"""
    return datetime.now(ZoneInfo("Asia/Seoul")).strftime("%Y-%m-%d %H:%M:%S")

# ëª¨ë“  ì´ë²¤íŠ¸ì— timestamp ì¶”ê°€
yield f"data: {json.dumps({..., 'timestamp': get_timestamp()}, ...)}\n\n"
```

**Frontend** (`app/static/simulator_experience.html`):
```javascript
function pushLog(text, timestamp){
    const timeStr = timestamp ? 
        ` <span style="color:#94a3b8;font-size:11px">[${timestamp}]</span>` : '';
    div.innerHTML = `<span class="logtag">[Step ${lines.length}]</span> ${text}${timeStr}`;
}
```

---

## ì˜ˆìƒ ë¡œê·¸ ì¶œë ¥ (ê°œì„  í›„)

```
[Step 1] NMS ìˆ˜ì‹  â†’ system='ë‹¨ìœ„DB ì„œë²„', severity='Critical'
[Step 2] LLM ë¶„ì„â€¦ ìš”ì•½: "ë‹¨ìœ„DB ì„œë²„ ë‹¤ìš´, ì„œë¹„ìŠ¤ ì˜í–¥ Critical"
[Step 3] ì¡°ê±´ íŒë‹¨: ê¸´ê¸‰ ê²½ë¡œ(YES) - Critical ì¥ì•  ê°ì§€
[Step 4] ITSM ì˜¨ì½œ ì¡°íšŒâ€¦ ì •ë‹´ë‹¹ì: ì‹¬ì›í  / 010-9894-2273
[Step 5] ITSM ì˜¨ì½œ ì¡°íšŒâ€¦ ë¶€ë‹´ë‹¹ì: í•œë¯¸ë‚˜ / 010-8672-1718
[Step 6] [ì‹¤ì œ ì „í™” ë°œì‹ ] ìˆœì°¨ ì—ìŠ¤ì»¬ë ˆì´ì…˜ ì‹œì‘
[Step 7] ğŸ“ ì •ë‹´ë‹¹ì ì‹¬ì›í  (010-9894-2273): ë°œì‹ ì¤‘... [2025-01-17 14:30:15]
[Step 7] âŒ ì‹¬ì›í : ì „í™” ì—°ê²° ì‹¤íŒ¨ (no-answer) [2025-01-17 14:30:30]
[Step 8] ğŸ“ ë¶€ë‹´ë‹¹ì í•œë¯¸ë‚˜ (010-8672-1718): ë°œì‹ ì¤‘... [2025-01-17 14:30:31]
[Step 8] âŒ í•œë¯¸ë‚˜: ì „í™” ì—°ê²° ì‹¤íŒ¨ (no-answer) [2025-01-17 14:30:46]
[Step 9] ğŸ“ ì •ë‹´ë‹¹ì(2ì°¨) ì‹¬ì›í  (010-9894-2273): ë°œì‹ ì¤‘... [2025-01-17 14:30:47]
[Step 9] âœ… ì‹¬ì›í : ì „í™” ì—°ê²° ì„±ê³µ! (í†µí™”ì‹œê°„: 15ì´ˆ) [2025-01-17 14:31:02]  âœ… ì •í™•!
[Step 10] ğŸ‰ ì—ìŠ¤ì»¬ë ˆì´ì…˜ ì„±ê³µ: ì‹¬ì›í ë‹˜ì´ ì „í™”ë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤. [2025-01-17 14:31:02]
[Step 11]    ì´ ì‹œë„ íšŸìˆ˜: 3íšŒ
[Step 12] Reporting ì €ì¥ ì™„ë£Œ - ì¥ì•  ì•Œë¦¼ ì´ë ¥ ê¸°ë¡
[Step 13] ê¸´ê¸‰ ì•Œë¦¼ ì›Œí¬í”Œë¡œìš° ì¢…ë£Œ
[Step 14] ì´ ì²˜ë¦¬ ì‹œê°„: 52.3ì´ˆ  âœ… ì‹¤ì œ ì‹œê°„ ë°˜ì˜!
```

---

## ìˆ˜ì •ëœ íŒŒì¼

1. **`app/routers/simulator.py`**
   - `check_call_status()`: duration ê¸°ë°˜ íŒì •ìœ¼ë¡œ ë³€ê²½
   - `escalate_with_status()`: íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€
   - `import datetime, ZoneInfo` ì¶”ê°€

2. **`app/static/simulator_experience.html`**
   - `pushLog()`: timestamp íŒŒë¼ë¯¸í„° ì¶”ê°€
   - `updateLastLog()`: timestamp íŒŒë¼ë¯¸í„° ì¶”ê°€
   - `handleSSEEvent()`: timestamp ì „ë‹¬
   - `runEmergency()`: startTime ê¸°ë¡, ì‹¤ì œ ê²½ê³¼ ì‹œê°„ ê³„ì‚°
   - "API ì—°ê²° ì¤‘..." ë¡œê·¸ ì œê±°

3. **`.env`**
   - UTF-8 ì¸ì½”ë”©ìœ¼ë¡œ ì¬ìƒì„± (í•œê¸€ ê¹¨ì§ ìˆ˜ì •)

---

## í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì •ë‹´ë‹¹ì ì¦‰ì‹œ ì‘ë‹µ
- ì˜ˆìƒ: 1íšŒ ì‹œë„ í›„ ì¢…ë£Œ
- ë¡œê·¸: "âœ… ì „í™” ì—°ê²° ì„±ê³µ" â†’ "ğŸ‰ ì—ìŠ¤ì»¬ë ˆì´ì…˜ ì„±ê³µ"

### ì‹œë‚˜ë¦¬ì˜¤ 2: ë¶€ë‹´ë‹¹ìë§Œ ì‘ë‹µ
- ì˜ˆìƒ: 2íšŒ ì‹œë„ (ì • ì‹¤íŒ¨ â†’ ë¶€ ì„±ê³µ)
- ë¡œê·¸: "âŒ ì •ë‹´ë‹¹ì ì‹¤íŒ¨" â†’ "âœ… ë¶€ë‹´ë‹¹ì ì„±ê³µ" â†’ "ğŸ‰ ì—ìŠ¤ì»¬ë ˆì´ì…˜ ì„±ê³µ"

### ì‹œë‚˜ë¦¬ì˜¤ 3: 3ë²ˆì§¸ ì‹œë„ì—ì„œ ì„±ê³µ
- **ì´ì „ ë¬¸ì œ**: ì„±ê³µí–ˆëŠ”ë°ë„ ì‹¤íŒ¨ë¡œ í‘œì‹œ âŒ
- **í˜„ì¬**: ì •í™•í•˜ê²Œ ì„±ê³µìœ¼ë¡œ í‘œì‹œ âœ…
- ë¡œê·¸: "âœ… ì „í™” ì—°ê²° ì„±ê³µ! (í†µí™”ì‹œê°„: 15ì´ˆ)"

### ì‹œë‚˜ë¦¬ì˜¤ 4: ëª¨ë‘ ì‹¤íŒ¨
- ì˜ˆìƒ: 4íšŒ ì‹œë„ í›„ ì‹¤íŒ¨
- ë¡œê·¸: "âš ï¸ ì—ìŠ¤ì»¬ë ˆì´ì…˜ ì‹¤íŒ¨: ëª¨ë“  ë‹´ë‹¹ìê°€ ì „í™”ë¥¼ ë°›ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
- ì´ ì²˜ë¦¬ ì‹œê°„: ì•½ 120ì´ˆ (15ì´ˆ Ã— 4 + ëŒ€ê¸°ì‹œê°„)

---

## ì„±ëŠ¥ ë° ì •í™•ë„

### Before (ìˆ˜ì • ì „)
- âŒ ì „í™” ìˆ˜ì‹  ì˜¤íƒ (answered_by í•„ë“œ ì˜ì¡´)
- âŒ ì´ ì²˜ë¦¬ ì‹œê°„ ë¶€ì •í™• (delay ì‹œê°„ë§Œ ê³„ì‚°)
- âŒ íƒ€ì„ìŠ¤íƒ¬í”„ ì—†ìŒ
- âŒ ë¶ˆí•„ìš”í•œ "API ì—°ê²° ì¤‘..." ë¡œê·¸

### After (ìˆ˜ì • í›„)
- âœ… ì „í™” ìˆ˜ì‹  ì •í™• íŒì • (duration >= 5ì´ˆ ê¸°ì¤€)
- âœ… ì´ ì²˜ë¦¬ ì‹œê°„ ì •í™• (ì‹¤ì œ ê²½ê³¼ ì‹œê°„)
- âœ… í•œêµ­ ì‹œê°„ íƒ€ì„ìŠ¤íƒ¬í”„ í‘œì‹œ
- âœ… ê°„ê²°í•œ ë¡œê·¸ ì¶œë ¥

---

## ì ìš© ë°©ë²•

1. ì„œë²„ ì¬ì‹œì‘:
```bash
cd "D:\9. Cursor_AI\AI_PG\AI_PlayGround"
uvicorn app.main:app --host 0.0.0.0 --port 8001
```

2. ë¸Œë¼ìš°ì € ì ‘ì†:
```
http://localhost:8001/static/simulator_experience.html
```

3. í…ŒìŠ¤íŠ¸:
   - ì •ë‹´ë‹¹ì, ë¶€ë‹´ë‹¹ì ë²ˆí˜¸ ì…ë ¥
   - "ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘" í´ë¦­
   - ë¡œê·¸ í™•ì¸ (íƒ€ì„ìŠ¤íƒ¬í”„, ì´ ì²˜ë¦¬ ì‹œê°„ í™•ì¸)

---

**ìˆ˜ì • ì™„ë£Œ ì¼ì‹œ**: 2025-01-17  
**ì„œë²„ ìƒíƒœ**: ì •ìƒ ì‹¤í–‰ ì¤‘ (í¬íŠ¸ 8001)  
**í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì™„ë£Œ**: âœ…

